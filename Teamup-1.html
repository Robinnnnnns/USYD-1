<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Up</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@800;900&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#F26B38; --primary-2:#FF8A5B;
      --bg:#F8F8F8; --card:#fff; --text:#1A1A1A; --muted:#666; --border:#E6E6E6;
      --shadow:0 8px 28px rgba(0,0,0,.10); --radius:16px; --trs:all .25s cubic-bezier(.4,0,.2,1);
      --success-bg:#EAFBF1; --success-text:#0E7A45; --success-border:#BFEAD1;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto}
    a{color:inherit;text-decoration:none}

    /* Topbar */
    .topbar{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);z-index:20}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;gap:12px}
    .search{flex:1;display:flex;align-items:center;gap:10px;border:1px solid var(--border);border-radius:999px;padding:10px 14px;background:#fff}
    .search input{flex:1;border:none;outline:none;font-size:1rem}
    .actions{display:flex;align-items:center;gap:10px;margin-left:auto}

    .btn{border:1px solid var(--border);background:#fff;border-radius:999px;padding:9px 14px;font-weight:800;cursor:pointer;transition:var(--trs);display:inline-flex;align-items:center;gap:8px}
    .btn:hover{transform:translateY(-1px)}
    .btn.nohover:hover{transform:none} /* Home / Avatar Êó†‰∏äÊèê */

    .seg{display:flex;border:1px solid var(--border);border-radius:999px;overflow:hidden}
    .seg button{padding:8px 12px;border:none;background:#fff;cursor:pointer;font-weight:800}
    .seg button.active{background:linear-gradient(135deg,var(--primary),var(--primary-2));color:#fff}

    .btn-toggle{border:1px solid var(--border);background:#fff;border-radius:999px;padding:9px 14px;font-weight:800;cursor:pointer;transition:var(--trs)}
    /* ‚òÖ Saved / My team ÊøÄÊ¥ªÊÄÅÔºö‰∏é Card/List ‰∏ÄËá¥ÁöÑÁ∫¢Ê©ôÊ∏êÂèò */
    .btn-toggle.active{
      background:linear-gradient(135deg,var(--primary),var(--primary-2));
      color:#fff;
      border:none;
      box-shadow:0 8px 18px rgba(242,107,56,.25);
    }

    .spacer{flex:1}

    /* Âè≥‰æßÁ∫¢Ëâ≤ÂúÜÂΩ¢ UÔºàÈìæÊé•Âà∞ Avatar1.htmlÔºâ */
    .pf{width:32px;height:32px;border-radius:50%;background:#FFE7DD;display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#B33E17;border:1px solid #FFD3C1}
    .pf:hover{transform:none}

    /* container */
    .wrap{max-width:1200px;margin:0 auto;padding:20px}
    .hero{margin:22px 0 12px}
    .hero h1{font-family:Merriweather,serif;font-weight:900;font-size:2.2rem;margin:0 0 6px}
    .hero p{color:var(--muted);margin:0}

    /* grid/list */
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px}
    .card{grid-column:span 4;background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;cursor:pointer;transition:var(--trs);display:flex;flex-direction:column}
    .card:hover{transform:translateY(-4px)}
    .head{display:flex;gap:14px;align-items:center;padding:16px 16px;border-bottom:1px solid var(--border);background:linear-gradient(180deg,#fff,#fffdfa)}
    .ava{width:54px;height:54px;border-radius:50%;background:#FFE7DD;border:2px solid #FFD3C1;display:flex;align-items:center;justify-content:center;font-weight:900;color:#B33E17;flex:none}
    .nm{font-weight:900;display:flex;align-items:center;gap:8px}

    /* tag ÂÆπÂô®ÔºöÂ¢ûÂä† row-gap Ëß£ÂÜ≥Êç¢Ë°åÂ§™Êå§ */
    .tags{display:flex;flex-wrap:wrap;column-gap:8px;row-gap:12px;padding:12px 16px}
    .tag{padding:.35rem .7rem;border-radius:999px;border:1px solid var(--border);background:#fafafa;font-weight:700;font-size:.86rem}

    .foot{margin-top:auto;display:flex;gap:10px;justify-content:flex-end;padding:14px 16px;border-top:1px solid var(--border)}
    .btn-ghost{border:1px solid var(--border);border-radius:12px;background:#fff;padding:8px 12px;font-weight:800;cursor:pointer}
    .btn-pri{border:none;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--primary-2));color:#fff;padding:9px 14px;font-weight:800;cursor:pointer;box-shadow:0 8px 18px rgba(242,107,56,.25)}

    .list{display:none}
    .row{display:grid;grid-template-columns:60px 1.6fr 2fr auto;gap:12px;align-items:center;background:#fff;border:1px solid var(--border);border-radius:12px;padding:10px 12px;box-shadow:var(--shadow);cursor:pointer}
    .row + .row{margin-top:12px}
    .row .tags{padding:0}
    .row .foot{border-top:none;margin:0;padding:0;gap:8px}
    .row .ava{width:46px;height:46px}
    .row .nm{display:flex;align-items:center;gap:8px}

    /* ÂæΩÊ†áÔºöTeammate */
    .badge{
      display:inline-flex;align-items:center;gap:6px;
      padding:2px 8px;border-radius:999px;font-size:.72rem;font-weight:800;
      background:var(--success-bg);color:var(--success-text);border:1px solid var(--success-border)
    }

    /* modals */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:50}
    .modal.open{display:flex}
    .modal-card{width:min(560px,92vw);background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);overflow:hidden}
    .modal-h{padding:16px 20px;border-bottom:1px solid var(--border);font-weight:900}
    .modal-b{padding:18px 20px;line-height:1.7}
    .modal-b .sec{margin:10px 0}
    .modal-f{padding:14px 20px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px}

    /* Chat modal */
    .chat-card{width:min(720px,95vw)}
    .chat-body{display:flex;flex-direction:column;height:min(65vh,640px)}
    .msgs{flex:1;overflow:auto;border-bottom:1px solid var(--border);padding:14px}
    .msg{max-width:70%;padding:10px 12px;border-radius:14px;margin:6px 0;box-shadow:var(--shadow)}
    .me{background:#fff7f3;border:1px solid #ffd3c1;margin-left:auto}
    .peer{background:#ffffff;border:1px solid var(--border)}
    .composer{display:flex;gap:8px;padding:12px}
    .composer input{flex:1;border:1px solid var(--border);border-radius:12px;padding:10px 12px;font-size:1rem}
    .composer button{padding:10px 14px;border:none;border-radius:12px;font-weight:800;cursor:pointer}
    .send{background:#111;color:#fff} /* Send=ÈªëÂ∫ïÁôΩÂ≠ó */
    .teamup{background:linear-gradient(135deg,var(--primary),var(--primary-2));color:#fff} /* Team Up=Ê©ôËâ≤ */

    .empty{padding:32px;border:1px dashed var(--border);border-radius:16px;background:#fff;color:#666;text-align:center}
    .empty h3{margin:0 0 10px}
    .empty .btn{margin-top:8px}

    @media (max-width:1100px){.card{grid-column:span 6}}
    @media (max-width:720px){
      .grid{grid-template-columns:repeat(6,1fr)}
      .card{grid-column:span 6}
      .row{grid-template-columns:46px 1.2fr 1.6fr auto}
    }
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 21l-4.2-4.2" stroke="#999" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#999" stroke-width="2" fill="none"/></svg>
        <input id="search" type="search" placeholder="Search names..." aria-label="Search names">
      </div>

      <div class="actions">
        <a class="btn nohover" href="index.html" title="Back to Home">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2h-5v-6H10v6H5a 2 2 0 0 1-2-2V10z" fill="none" stroke="#444" stroke-width="1.6"/></svg>
          Home
        </a>

        <div class="seg" role="tablist" aria-label="layout switcher">
          <button id="btnCard" class="active" role="tab" aria-selected="true" aria-controls="view-card">Card</button>
          <button id="btnList" role="tab" aria-selected="false" aria-controls="view-list">List</button>
        </div>

        <button id="btnSaved" class="btn-toggle" title="Show saved">Saved</button>
        <button id="btnTeam" class="btn-toggle" title="Show my team">My team</button>

        <span class="spacer"></span>

        <!-- Á∫¢Ëâ≤ÂúÜÂΩ¢ UÔºåÊúÄÂè≥ÔºõË∑≥ËΩ¨ Avatar1.htmlÔºõÊó†ÊÇ¨ÂÅú‰∏äÊèê -->
        <a href="Avatar1.html" id="avatarLink" class="btn nohover" style="padding:0;border:none;background:transparent">
          <span class="pf" id="mePF">U</span>
        </a>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" aria-live="polite">
      <h1>Let's team up</h1>
      <p>Find classmates by name. View their avatar and tags. Connect and chat, then team up together.</p>
    </section>

    <section id="view-card" class="grid" aria-label="Card results"></section>
    <section id="view-list" class="list" aria-label="List results"></section>
  </main>

  <!-- Profile Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-h" id="modalTitle">Profile</div>
      <div class="modal-b" id="modalBody"></div>
      <div class="modal-f"><button class="btn" id="modalClose">Close</button></div>
    </div>
  </div>

  <!-- Chat Modal -->
  <div id="chatModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card chat-card" role="document">
      <div class="modal-h"><span id="chatWith">Chat</span></div>
      <div class="modal-b chat-body">
        <div id="msgs" class="msgs" aria-live="polite"></div>
        <div class="composer">
          <input id="msgInput" type="text" placeholder="Type a message‚Ä¶"/>
          <button class="send" id="sendBtn">Send</button>
          <button class="teamup" id="teamUpBtn">Team Up</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* Ê∏ÖÊéâÊóßÁâàÊú¨ÂèØËÉΩÂ≠òÁöÑ favourites / teammatesÔºàÊî∂Ëóè„ÄÅÈòüÂèãÈÉΩ‰∏çÊåÅ‰πÖÂåñÔºâ */
    try{
      localStorage.removeItem('favourites');
      localStorage.removeItem('teammates');
    }catch(e){}

    const TAG_POOL=["Empathetic","Adventurous","Detail-Oriented","Open-Minded","Reflective","Passionate","Technical","Research","Storytelling","Communication","Prototyping","Visualization","Leader","Facilitator","Strategist","Motivator","Innovator","Critic"];
    function sampleTags(k){const p=[...TAG_POOL];for(let i=p.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]]}return p.slice(0,k)}

    // È°∂ÈÉ®Á∫¢ÂúÜ UÔºàËØªÂèñ‰∏ÄÊ¨°È¶ñÂ≠óÊØçÔºâ
    const initial=(localStorage.getItem('avatar_initial')||'U').slice(0,1).toUpperCase();
    const meEl=document.getElementById('mePF'); if(meEl){ meEl.textContent=initial; }

    const people=[
      {id:'u1',name:'Alex Chen',initial:'A',desc:'Mixed-methods researcher. Diary study enjoyer.',portfolio:'',tags:sampleTags(5)},
      {id:'u2',name:'Bella Wu',initial:'B',desc:'Design systems & prototyping.',portfolio:'',tags:sampleTags(5)},
      {id:'u3',name:'Chris Li',initial:'C',desc:'Frontend dev. Accessibility advocate.',portfolio:'',tags:sampleTags(5)},
      {id:'u4',name:'Dylan Park',initial:'D',desc:'Motion & micro-interactions.',portfolio:'',tags:sampleTags(5)},
      {id:'u5',name:'Erin Zhao',initial:'E',desc:'Service design & facilitation.',portfolio:'',tags:sampleTags(5)},
      {id:'u6',name:'Felix Tran',initial:'F',desc:'Data viz & product thinking.',portfolio:'',tags:sampleTags(5)}
    ];

    /* ---- Áä∂ÊÄÅÔºà‰ªÖÂÜÖÂ≠òÔºâ ---- */
    const state={ favourites:[], teammates:[], view:'card', filter:'all' };

    const viewCardEl=document.getElementById('view-card');
    const viewListEl=document.getElementById('view-list');
    const btnCard=document.getElementById('btnCard');
    const btnList=document.getElementById('btnList');
    const btnSaved=document.getElementById('btnSaved');
    const btnTeam=document.getElementById('btnTeam');

    // Profile
    const modal=document.getElementById('modal');
    const modalTitle=document.getElementById('modalTitle');
    const modalBody=document.getElementById('modalBody');
    const modalClose=document.getElementById('modalClose');

    // Chat
    const chatModal=document.getElementById('chatModal');
    const chatWithEl=document.getElementById('chatWith');
    const msgsEl=document.getElementById('msgs');
    const msgInput=document.getElementById('msgInput');
    const sendBtn=document.getElementById('sendBtn');
    const teamUpBtn=document.getElementById('teamUpBtn');

    const isFav=id=>state.favourites.includes(id);
    const isTeam=id=>state.teammates.includes(id);
    const toggleFav=id=>{
      const i=state.favourites.indexOf(id);
      if(i===-1) state.favourites.push(id);
      else state.favourites.splice(i,1);
      render();
    };
    function addTeammate(id){ if(!state.teammates.includes(id)){ state.teammates.push(id); } }

    /* Êõ¥Êñ∞ËÅäÂ§©Ê°Ü‰∏≠ Team Up ÊåâÈíÆÊñáÊ°à/Áä∂ÊÄÅ */
    function updateTeamUpButton(uid){
      if(state.teammates.includes(uid)){
        teamUpBtn.textContent='Already teammates';
        teamUpBtn.disabled=true;
        teamUpBtn.style.background='#ccc';
        teamUpBtn.style.cursor='not-allowed';
      }else{
        teamUpBtn.textContent='Team Up';
        teamUpBtn.disabled=false;
        teamUpBtn.style.background='linear-gradient(135deg,var(--primary),var(--primary-2))';
        teamUpBtn.style.cursor='pointer';
      }
    }

    // Profile ÂºπÁ™ó
    const openProfile=p=>{
      modalTitle.textContent=p.name;
      const hasURL=p.portfolio&&p.portfolio.trim();
      modalBody.innerHTML=`
        <div class="sec"><strong>Description</strong><br>${p.desc||'‚Äî'}</div>
        <div class="sec"><strong>Portfolio</strong><br>${hasURL?`<a href="${p.portfolio}" target="_blank" rel="noopener">Visit portfolio</a>`:'‚Äî'}</div>
        <div class="sec">
          <strong>Tags</strong><br>
          <div class="tags">
            ${(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('')}
          </div>
        </div>
      `;
      modal.classList.add('open'); modal.setAttribute('aria-hidden','false');
    };
    const closeProfile=()=>{modal.classList.remove('open');modal.setAttribute('aria-hidden','true')};

    // Chat
    const chats={};
    function openChat(p){
      if(!chats[p.id]){chats[p.id]=[{from:'peer',text:`Hey! I'm ${p.name}. Nice to meet you üëã`}];}
      chatWithEl.textContent=`Chat with ${p.name}`;
      chatModal.dataset.userId=p.id;
      renderChat(p.id);
      chatModal.classList.add('open'); chatModal.setAttribute('aria-hidden','false');
      updateTeamUpButton(p.id);      // ÊâìÂºÄÊó∂Âà∑Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
      setTimeout(()=>msgInput.focus(),50);
    }
    function closeChat(){chatModal.classList.remove('open');chatModal.setAttribute('aria-hidden','true')}
    function renderChat(uid){const list=chats[uid]||[];msgsEl.innerHTML=list.map(m=>`<div class="msg ${m.from==='me'?'me':'peer'}">${m.text}</div>`).join('');msgsEl.scrollTop=msgsEl.scrollHeight}
    function sendMessage(){const uid=chatModal.dataset.userId;const txt=msgInput.value.trim();if(!txt)return;(chats[uid]=chats[uid]||[]).push({from:'me',text:txt});msgInput.value='';renderChat(uid)}
    function teamUpCurrent(){
      const uid=chatModal.dataset.userId;
      addTeammate(uid);
      alert('Team up success! üéâ');
      updateTeamUpButton(uid);  // Á´ãÂç≥ÂèòÊõ¥‰∏∫ Already teammates
      render();                 // ÂàóË°®/Âç°ÁâáÊõ¥Êñ∞ÂæΩÊ†áÂíåËøáÊª§ËßÜÂõæ
    }

    function getSearchFiltered(){
      const q=(document.getElementById('search').value||'').trim().toLowerCase();
      let items=people;
      if(q) items=items.filter(p=>p.name.toLowerCase().includes(q));
      if(state.filter==='saved') items=items.filter(p=>isFav(p.id));
      if(state.filter==='team')  items=items.filter(p=>isTeam(p.id));
      return items.slice(0,6);
    }

    /* Â∏¶ Teammate ÂæΩÊ†áÁöÑÊ®°Êùø */
    function nameWithBadge(p){
      return `${p.name}${isTeam(p.id)?` <span class="badge">‚úî Teammate</span>`:''}`;
    }

    function personCard(p){
      const fav=isFav(p.id);
      const tags=(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      return `
        <article class="card" data-id="${p.id}" role="button" tabindex="0" aria-label="${p.name}">
          <div class="head">
            <div class="ava">${p.initial}</div>
            <div class="nm">${nameWithBadge(p)}</div>
          </div>
          <div class="tags">${tags}</div>
          <div class="foot" role="group" aria-label="actions" data-stop>
            <button class="btn-ghost" data-fav="${p.id}" aria-pressed="${fav}" title="Save">
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 17.3l-5.5 3 1-6.1L3 9.7l6.2-.9L12 3l2.8 5.8 6.2.9-4.5 4.5 1 6.1z" fill="${fav?'#F26B38':'none'}" stroke="#F26B38" stroke-width="1.5"/>
              </svg> Save
            </button>
            <button class="btn-pri" data-connect="${p.id}">Connect</button>
          </div>
        </article>
      `;
    }
    function personRow(p){
      const fav=isFav(p.id);
      const tags=(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      return `
        <div class="row" data-id="${p.id}" role="button" tabindex="0" aria-label="${p.name}">
          <div class="ava">${p.initial}</div>
          <div class="nm">${nameWithBadge(p)}</div>
          <div class="tags">${tags}</div>
          <div class="foot" role="group" aria-label="actions" data-stop>
            <button class="btn-ghost" data-fav="${p.id}" aria-pressed="${fav}" title="Save">
              <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 17.3l-5.5 3 1-6.1L3 9.7l6.2-.9L12 3l2.8 5.8 6.2.9-4.5 4.5 1 6.1z" fill="${fav?'#F26B38':'none'}" stroke="#F26B38" stroke-width="1.5"/>
              </svg>
            </button>
            <button class="btn-pri" data-connect="${p.id}">Connect</button>
          </div>
        </div>
      `;
    }

    function render(){
      const items=getSearchFiltered();
      let emptyHTML=`<div class="empty"><h3>No results here yet.</h3><div>Try clearing your search.</div></div>`;
      if(state.filter==='saved'){
        emptyHTML=`<div class="empty"><h3>No saved classmates yet.</h3><div>Use ‚ÄúSave‚Äù on a card to add here.</div><button class="btn" data-clear-filter>Back to All</button></div>`;
      }else if(state.filter==='team'){
        emptyHTML=`<div class="empty"><h3>No teammates yet.</h3><div>Use ‚ÄúTeam Up‚Äù in chat to add here.</div><button class="btn" data-clear-filter>Back to All</button></div>`;
      }

      if(state.view==='card'){
        viewCardEl.style.display='grid'; viewListEl.style.display='none';
        viewCardEl.innerHTML=items.length?items.map(personCard).join(''):emptyHTML;
      }else{
        viewCardEl.style.display='none'; viewListEl.style.display='block';
        viewListEl.innerHTML=items.length?items.map(personRow).join(''):emptyHTML;
      }
    }

    // ‰∫§‰∫í
    document.addEventListener('click',(e)=>{
      const favBtn=e.target.closest('[data-fav]');
      const connectBtn=e.target.closest('[data-connect]');
      const clearBtn=e.target.closest('[data-clear-filter]');
      const stopArea=e.target.closest('[data-stop]');
      if(clearBtn){ state.filter='all'; btnSaved.classList.remove('active'); btnTeam.classList.remove('active'); render(); return; }
      if(favBtn){e.preventDefault();e.stopPropagation();toggleFav(favBtn.dataset.fav);return}
      if(connectBtn){e.preventDefault();e.stopPropagation();const p=people.find(x=>x.id===connectBtn.dataset.connect);if(p)openChat(p);return}
      const card=e.target.closest('.card, .row');
      if(card && !stopArea){const id=card.getAttribute('data-id');const p=people.find(x=>x.id===id);if(p)openProfile(p)}
    });

    btnCard.addEventListener('click',()=>{state.view='card';btnCard.classList.add('active');btnList.classList.remove('active');render()});
    btnList.addEventListener('click',()=>{state.view='list';btnList.classList.add('active');btnCard.classList.remove('active');render()});
    btnSaved.addEventListener('click',()=>{const active=state.filter==='saved';state.filter=active?'all':'saved';btnSaved.classList.toggle('active',!active);btnTeam.classList.remove('active');render()});
    btnTeam.addEventListener('click',()=>{const active=state.filter==='team';state.filter=active?'all':'team';btnTeam.classList.toggle('active',!active);btnSaved.classList.remove('active');render()});
    document.getElementById('search').addEventListener('input',render);

    modalClose.addEventListener('click',closeProfile);
    document.getElementById('modal').addEventListener('click',(e)=>{if(e.target.id==='modal')closeProfile()});

    document.getElementById('chatModal').addEventListener('click',(e)=>{if(e.target.id==='chatModal')closeChat()});
    sendBtn.addEventListener('click',sendMessage);
    msgInput.addEventListener('keydown',(e)=>{if(e.key==='Enter')sendMessage()});
    teamUpBtn.addEventListener('click',teamUpCurrent);

    render();
  </script>
</body>
</html>
