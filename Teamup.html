<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Team Up</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@800;900&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary-orange:#F26B38;--orange-light:#FF8C5A;--orange-glow:rgba(242,107,56,.25);
      --deep-black:#0A0A0A;--mid-grey:#6E6E6E;--light-grey:#DADADA;--ultra-light:#F2F2F2;--pure-white:#FFFFFF;
      --card-bg:#FFFFFF;--page-bg:#F8F8F8;--border-color:#E5E5E5;
      --shadow-sm:0 2px 8px rgba(0,0,0,.04);--shadow-md:0 4px 16px rgba(0,0,0,.08);
      --shadow-lg:0 8px 32px rgba(0,0,0,.12);--shadow-xl:0 16px 48px rgba(0,0,0,.16);
      --transition-smooth:all .28s cubic-bezier(.4,0,.2,1);--ease:cubic-bezier(.4,0,.2,1);
    }
    body{
      font-family:'Inter',sans-serif;background:var(--page-bg);color:var(--deep-black);
      line-height:1.7;overflow-x:hidden
    }
    h1,h2,h3,h4{font-family:'Merriweather',serif}

    /* Navbar */
    .navbar{
      position:fixed;top:0;left:0;right:0;height:88px;background:var(--primary-orange);
      display:flex;align-items:center;gap:16px;padding:0 64px;box-shadow:var(--shadow-sm);
      z-index:9999;border-bottom:1px solid var(--border-color)
    }
    .nav-left{display:flex;align-items:center;gap:24px}
    .logo{color:#fff;font-weight:900}
    .nav-actions{margin-left:auto;display:flex;align-items:center;gap:12px}

    .search{
      flex:1;display:flex;align-items:center;gap:10px;background:#fff;border:1px solid var(--border-color);
      border-radius:999px;padding:10px 14px;box-shadow:var(--shadow-sm);max-width:560px
    }
    .search input{flex:1;border:none;outline:none;font-size:15px;color:var(--deep-black)}

    .seg{display:flex;border:1px solid var(--border-color);border-radius:999px;overflow:hidden;background:#fff}
    .seg button{
      border:none;padding:8px 12px;font-weight:800;cursor:pointer;background:#fff;color:var(--deep-black);
      transition:var(--transition-smooth)
    }
    .seg button.active{
      color:#fff;background:linear-gradient(135deg,var(--primary-orange),var(--orange-light));
      box-shadow:0 8px 18px var(--orange-glow)
    }
    .btn-toggle{
      border:1px solid var(--border-color);background:#fff;border-radius:999px;
      padding:9px 14px;font-weight:800;cursor:pointer;transition:var(--transition-smooth);color:var(--deep-black)
    }
    .btn-toggle.active{
      background:linear-gradient(135deg,var(--primary-orange),var(--orange-light));
      color:#fff;border:none;box-shadow:0 8px 18px var(--orange-glow)
    }
    .btn-home{
      display:inline-flex;align-items:center;gap:8px;border:1px solid var(--border-color);
      background:#fff;border-radius:999px;padding:9px 14px;font-weight:800;color:var(--deep-black)
    }
    .pf{
      width:40px;height:40px;border-radius:50%;background:#FFE7DD;border:1px solid #FFD3C1;
      display:inline-flex;align-items:center;justify-content:center;color:#B33E17;font-weight:900;box-shadow:var(--shadow-lg)
    }

    .wrap{max-width:1200px;margin:0 auto;padding:24px 24px 48px;margin-top:104px}
    .hero{margin:8px 0 16px}
    .hero h1{font-weight:900;font-size:2.2rem;margin:0 0 6px;color:#111}
    .hero p{color:var(--mid-grey);margin:0}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px}
    .card{
      grid-column:span 4;background:#fff;border:1px solid var(--border-color);border-radius:16px;
      box-shadow:var(--shadow-md);overflow:hidden;cursor:pointer;transition:var(--transition-smooth);
      display:flex;flex-direction:column
    }
    .card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
    .head{
      display:flex;gap:14px;align-items:center;padding:16px;border-bottom:1px solid var(--border-color);
      background:linear-gradient(180deg,#fff,#FFFCF7)
    }
    .ava{
      width:54px;height:54px;border-radius:50%;background:#FFE7DD;border:2px solid #FFD3C1;
      display:flex;align-items:center;justify-content:center;font-weight:900;color:#B33E17;flex:none;overflow:hidden
    }
    .ava-img{width:100%;height:100%;border-radius:50%;object-fit:cover;display:block}
    .nm{font-weight:900;display:flex;align-items:center;gap:8px}

    .tags{
      display:flex;flex-wrap:wrap;column-gap:8px;row-gap:12px;padding:12px 16px
    }
    .tag{
      padding:.35rem .7rem;border-radius:999px;border:1px solid var(--border-color);background:#fafafa;
      font-weight:700;font-size:.86rem;color:#111
    }

    .foot{
      margin-top:auto;display:flex;gap:10px;justify-content:flex-end;padding:14px 16px;border-top:1px solid var(--border-color)
    }
    .btn-ghost{
      border:1px solid var(--border-color);border-radius:12px;background:#fff;padding:8px 12px;font-weight:800;cursor:pointer;color:#111
    }
    .btn-pri{
      border:none;border-radius:12px;background:linear-gradient(135deg,var(--primary-orange),var(--orange-light));color:#fff;
      padding:9px 14px;font-weight:800;cursor:pointer;box-shadow:0 8px 18px var(--orange-glow)
    }

    .list{display:none}
    .row{
      display:grid;grid-template-columns:60px 1.6fr 2fr auto;gap:12px;align-items:center;background:#fff;
      border:1px solid var(--border-color);border-radius:12px;padding:10px 12px;box-shadow:var(--shadow-md);cursor:pointer
    }
    .row+.row{margin-top:12px}
    .row .ava{width:46px;height:46px}
    .row .nm{display:flex;align-items:center;gap:8px}
    .row .tags{padding:0}
    .row .foot{border-top:none;margin:0;padding:0;gap:8px}

    .badge{
      display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;font-size:.72rem;font-weight:800;
      background:#EAFBF1;color:#0E7A45;border:1px solid #BFEAD1
    }

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:99999}
    .modal.open{display:flex}
    .modal-card{width:min(560px,92vw);background:#fff;border:1px solid var(--border-color);border-radius:16px;box-shadow:var(--shadow-lg);overflow:hidden}
    .modal-h{padding:16px 20px;border-bottom:1px solid var(--border-color);font-weight:900}
    .modal-b{padding:18px 20px;line-height:1.7}
    .modal-b .sec{margin:10px 0}
    .modal-f{padding:14px 20px;border-top:1px solid var(--border-color);display:flex;justify-content:flex-end;gap:10px}

    .chat-card{width:min(720px,95vw)}
    .chat-body{display:flex;flex-direction:column;height:min(65vh,640px)}
    .msgs{flex:1;overflow:auto;border-bottom:1px solid var(--border-color);padding:14px;background:#fff}
    .msg{max-width:70%;padding:10px 12px;border-radius:14px;margin:6px 0;box-shadow:var(--shadow-sm)}
    .me{background:#FFF4ED;border:1px solid #FFD3C1;margin-left:auto}
    .peer{background:#FFFFFF;border:1px solid var(--border-color)}
    .composer{display:flex;gap:8px;padding:12px;background:#fff}
    .composer input{flex:1;border:1px solid var(--border-color);border-radius:12px;padding:10px 12px;font-size:1rem}
    .composer button{padding:10px 14px;border:none;border-radius:12px;font-weight:800;cursor:pointer}
    .send{background:#0A0A0A;color:#fff}
    .teamup{background:linear-gradient(135deg,var(--primary-orange),var(--orange-light));color:#fff}

    .empty{padding:32px;border:1px dashed var(--border-color);border-radius:16px;background:#fff;color:#666;text-align:center;box-shadow:var(--shadow-sm)}
    .empty h3{margin:0 0 10px}
    .empty .btn{margin-top:8px}

    @media (max-width:1100px){.card{grid-column:span 6}}
    @media (max-width:720px){
      .grid{grid-template-columns:repeat(6,1fr)}
      .card{grid-column:span 6}
      .row{grid-template-columns:46px 1.2fr 1.6fr auto}
      .navbar{padding:0 16px}
      .search{max-width:none}
    }

    /* Âè≥‰∏äËßíÂúÜÂΩ¢ÈáåÁöÑÂõæÁâáÊ†∑Âºè */
  .pf-img{
  width:100%;
  height:100%;
  border-radius:50%;
  object-fit:cover;
  display:block;
}

  </style>
</head>

<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="nav-left">
    </div>

    <div class="search" role="search" aria-label="Search names">
      <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 21l-4.2-4.2" stroke="#999" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#999" stroke-width="2" fill="none"/></svg>
      <input id="search" type="search" placeholder="Search names...">
    </div>

    <div class="nav-actions">
      <a class="btn-home" href="index.html" title="Back to Home">
        <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2h-5v-6H10v6H5a 2 2 0 0 1-2-2V10z" fill="none" stroke="#444" stroke-width="1.6"/></svg>
        Home
      </a>

      <div class="seg" role="tablist" aria-label="layout">
        <button id="btnCard" class="active" role="tab" aria-selected="true" aria-controls="view-card">Card</button>
        <button id="btnList" role="tab" aria-selected="false" aria-controls="view-list">List</button>
      </div>

      <button id="btnSaved" class="btn-toggle" title="Show saved">Saved</button>
      <button id="btnTeam" class="btn-toggle" title="Show my team">My team</button>

      <a href="Avatar1.html" class="pf" id="mePF" title="My avatar">U</a>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" aria-live="polite">
      <h1>Let's team up!</h1>
      <p>Find the right people to work with.</p>
    </section>

    <section id="view-card" class="grid" aria-label="Card results"></section>
    <section id="view-list" class="list" aria-label="List results"></section>
  </main>

  <!-- Profile Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card" role="document">
      <div class="modal-h" id="modalTitle">Profile</div>
      <div class="modal-b" id="modalBody"></div>
      <div class="modal-f"><button class="btn-ghost" id="modalClose">Close</button></div>
    </div>
  </div>

  <!-- Chat Modal -->
  <div id="chatModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card chat-card" role="document">
      <div class="modal-h"><span id="chatWith">Chat</span></div>
      <div class="modal-b chat-body">
        <div id="msgs" class="msgs" aria-live="polite"></div>
        <div class="composer">
          <input id="msgInput" type="text" placeholder="Type a message‚Ä¶"/>
          <button class="send" id="sendBtn">Send</button>
          <button class="teamup" id="teamUpBtn">Team Up</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const avatarImage = localStorage.getItem('user_avatar');
const pfEl = document.getElementById('mePF');

if (avatarImage) {
  pfEl.style.backgroundImage = `url(${avatarImage})`;
  pfEl.style.backgroundSize = 'cover';
  pfEl.style.backgroundPosition = 'center';
  pfEl.textContent = '';
}

    /* Not persistent each refresh */
    try{ localStorage.removeItem('favourites'); localStorage.removeItem('teammates'); }catch(e){}

    const TAG_POOL=["Empathetic","Adventurous","Detail-Oriented","Open-Minded","Reflective","Passionate","Technical","Research","Storytelling","Communication","Prototyping","Visualization","Leader","Facilitator","Strategist","Motivator","Innovator","Critic"];
    function sampleTags(k){const p=[...TAG_POOL];for(let i=p.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[p[i],p[j]]=[p[j],p[i]]}return p.slice(0,k)}

    const mePF = document.getElementById('mePF');

// ÂÖàÁî®Â≠óÊØç‰Ωú‰∏∫ÂÖúÂ∫ï
const fallbackInitial = (localStorage.getItem('avatar_initial') || 'U').slice(0,1).toUpperCase();
mePF.textContent = fallbackInitial;

// ‰ªé avatar3.html ÂÜôÂÖ•ÁöÑ localStorage ÊÅ¢Â§çÂ§¥ÂÉè
(function restoreTopRightAvatar(){
  try{
    const raw = localStorage.getItem('avatarSelection');
    if(!raw) return;
    const { avatarSrc, bgColor, bgStyle } = JSON.parse(raw) || {};
    if (avatarSrc){
      // Ê∏ÖÁ©∫ÂéüÊù•ÁöÑ UÔºåÊîæÂÖ•ÂõæÁâá
      mePF.textContent = '';
      const img = document.createElement('img');
      img.src = avatarSrc;          // ÂèØ‰ª•ÊòØ base64 Êàñ‰∏Ä‰∏™Áõ∏ÂØπË∑ØÂæÑ
      img.alt = 'My avatar';
      img.className = 'pf-img';
      mePF.appendChild(img);
    }
    // Â¶ÇÊûú‰Ω†Â∏åÊúõÊ≤øÁî®Â§¥ÂÉèÈ¢ÑËßàÊó∂ÁöÑËÉåÊôØËâ≤/Ê∏êÂèòÔºàÂèØÈÄâÔºâ
    const bg = bgStyle || bgColor;
    if (bg) mePF.style.background = bg;
  }catch(e){
    console.warn('Failed to load avatarSelection', e);
  }
})();


    // First user uses Assets/head1.png (case sensitive)
    const people=[
      {id:'u1',name:'Aiden Yang',initial:'A',photo:'Assets/head1.png',desc:'Mixed-methods researcher. Diary study enjoyer.',portfolio:'',tags:sampleTags(5)},
      {id:'u2',name:'Fan Wu',initial:'B',photo:'Assets/head2.png',desc:'Design systems & prototyping.',portfolio:'',tags:sampleTags(5)},
      {id:'u3',name:'Robin Wang',initial:'C',photo:'Assets/head3.png',desc:'Frontend dev. Accessibility advocate.',portfolio:'',tags:sampleTags(5)},
      {id:'u4',name:'Beatrice Park',initial:'D',photo:'Assets/head4.png',desc:'Motion & micro-interactions.',portfolio:'',tags:sampleTags(5)},
      {id:'u5',name:'Soysauce Shuai',initial:'E',photo:'Assets/head5.png',desc:'Service design & facilitation.',portfolio:'',tags:sampleTags(5)},
      {id:'u6',name:'Jiawei Liu',initial:'F',photo:'Assets/head6.png',desc:'Data viz & product thinking.',portfolio:'',tags:sampleTags(5)}
    ];

    const state={favourites:[],teammates:[],view:'card',filter:'all'};
    const viewCardEl=document.getElementById('view-card');
    const viewListEl=document.getElementById('view-list');
    const btnCard=document.getElementById('btnCard');
    const btnList=document.getElementById('btnList');
    const btnSaved=document.getElementById('btnSaved');
    const btnTeam=document.getElementById('btnTeam');

    const modal=document.getElementById('modal');
    const modalTitle=document.getElementById('modalTitle');
    const modalBody=document.getElementById('modalBody');

    const chatModal=document.getElementById('chatModal');
    const chatWithEl=document.getElementById('chatWith');
    const msgsEl=document.getElementById('msgs');
    const msgInput=document.getElementById('msgInput');
    const sendBtn=document.getElementById('sendBtn');
    const teamUpBtn=document.getElementById('teamUpBtn');

    const isFav=id=>state.favourites.includes(id);
    const isTeam=id=>state.teammates.includes(id);
    function toggleFav(id){const i=state.favourites.indexOf(id); if(i===-1)state.favourites.push(id); else state.favourites.splice(i,1); render();}
    function addTeammate(id){if(!state.teammates.includes(id))state.teammates.push(id);}

    function updateTeamUpButton(uid){
      if(isTeam(uid)){
        teamUpBtn.textContent='Already teammates';
        teamUpBtn.disabled=true;
        teamUpBtn.style.background='#CFCFCF';
        teamUpBtn.style.cursor='not-allowed';
      }else{
        teamUpBtn.textContent='Team Up';
        teamUpBtn.disabled=false;
        teamUpBtn.style.background='linear-gradient(135deg,var(--primary-orange),var(--orange-light))';
        teamUpBtn.style.cursor='pointer';
      }
    }

    function nameWithBadge(p){return `${p.name}${isTeam(p.id)?` <span class="badge">‚úî Teammate</span>`:''}`}

    function personCard(p){
      const fav=isFav(p.id);
      const tags=(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      return `
      <article class="card" data-id="${p.id}" role="button" tabindex="0" aria-label="${p.name}">
        <div class="head">
          <div class="ava">${p.photo ? `<img src="${p.photo}" alt="${p.name}'s avatar" class="ava-img">` : p.initial}</div>
          <div class="nm">${nameWithBadge(p)}</div>
        </div>
        <div class="tags">${tags}</div>
        <div class="foot" data-stop>
          <button class="btn-ghost" data-fav="${p.id}" aria-pressed="${fav}" title="Save">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 17.3l-5.5 3 1-6.1L3 9.7l6.2-.9L12 3l2.8 5.8 6.2.9-4.5 4.5 1 6.1z" fill="${fav?'#F26B38':'none'}" stroke="#F26B38" stroke-width="1.5"/>
            </svg> Save
          </button>
          <button class="btn-pri" data-connect="${p.id}">Connect</button>
        </div>
      </article>`;
    }

    function personRow(p){
      const fav=isFav(p.id);
      const tags=(p.tags||[]).map(t=>`<span class="tag">${t}</span>`).join('');
      return `
      <div class="row" data-id="${p.id}" role="button" tabindex="0" aria-label="${p.name}">
        <div class="ava">${p.photo ? `<img src="${p.photo}" alt="${p.name}'s avatar" class="ava-img">` : p.initial}</div>
        <div class="nm">${nameWithBadge(p)}</div>
        <div class="tags">${tags}</div>
        <div class="foot" data-stop>
          <button class="btn-ghost" data-fav="${p.id}" aria-pressed="${fav}" title="Save">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 17.3l-5.5 3 1-6.1L3 9.7l6.2-.9L12 3l2.8 5.8 6.2.9-4.5 4.5 1 6.1z" fill="${fav?'#F26B38':'none'}" stroke="#F26B38" stroke-width="1.5"/>
            </svg>
          </button>
          <button class="btn-pri" data-connect="${p.id}">Connect</button>
        </div>
      </div>`;
    }

    function filtered(){
      const q=(document.getElementById('search').value||'').trim().toLowerCase();
      let items=people;
      if(q) items=items.filter(p=>p.name.toLowerCase().includes(q));
      if(state.filter==='saved') items=items.filter(p=>isFav(p.id));
      if(state.filter==='team') items=items.filter(p=>isTeam(p.id));
      return items.slice(0,6);
    }

    function render(){
      const items=filtered();
      let emptyHTML=`<div class="empty"><h3>No results here yet.</h3><div>Try clearing your search.</div></div>`;
      if(state.filter==='saved') emptyHTML=`<div class="empty"><h3>No saved classmates yet.</h3><div>Use ‚ÄúSave‚Äù on a card to add here.</div><button class="btn-ghost" data-clear-filter>Back to All</button></div>`;
      if(state.filter==='team')  emptyHTML=`<div class="empty"><h3>No teammates yet.</h3><div>Use ‚ÄúTeam Up‚Äù in chat to add here.</div><button class="btn-ghost" data-clear-filter>Back to All</button></div>`;

      if(state.view==='card'){
        viewCardEl.style.display='grid';viewListEl.style.display='none';
        viewCardEl.innerHTML = items.length?items.map(personCard).join(''):emptyHTML;
      }else{
        viewCardEl.style.display='none';viewListEl.style.display='block';
        viewListEl.innerHTML = items.length?items.map(personRow).join(''):emptyHTML;
      }
      btnSaved.classList.toggle('active',state.filter==='saved');
      btnTeam.classList.toggle('active',state.filter==='team');
      btnCard.classList.toggle('active',state.view==='card');
      btnList.classList.toggle('active',state.view==='list');
    }

    document.addEventListener('click',e=>{
      const favBtn=e.target.closest('[data-fav]');
      const connectBtn=e.target.closest('[data-connect]');
      const clearBtn=e.target.closest('[data-clear-filter]');
      const stopArea=e.target.closest('[data-stop]');
      if(clearBtn){state.filter='all';render();return;}
      if(favBtn){e.preventDefault();e.stopPropagation();toggleFav(favBtn.dataset.fav);return;}
      if(connectBtn){e.preventDefault();e.stopPropagation();const p=people.find(x=>x.id===connectBtn.dataset.connect);if(p)openChat(p);return;}
      const item=e.target.closest('.card,.row');
      if(item && !stopArea){
        const id=item.getAttribute('data-id');
        const p=people.find(x=>x.id===id);
        if(p) openProfile(p);
      }
    });
    document.getElementById('search').addEventListener('input',render);
    btnCard.addEventListener('click',()=>{state.view='card';render()});
    btnList.addEventListener('click',()=>{state.view='list';render()});
    btnSaved.addEventListener('click',()=>{state.filter=state.filter==='saved'?'all':'saved';render()});
    btnTeam.addEventListener('click',()=>{state.filter=state.filter==='team'?'all':'team';render()});

    // Profile modal
    function openProfile(person){
      document.getElementById('modalTitle').textContent=person.name;
      document.getElementById('modalBody').innerHTML = `
        <div class="sec"><strong>Description</strong><br>${person.desc || '‚Äî'}</div>
        <div class="sec"><strong>Portfolio</strong><br>${person.portfolio ? `<a href="${person.portfolio}" target="_blank" rel="noopener">Visit portfolio</a>` : '‚Äî'}</div>
        <div class="sec"><strong>Tags</strong><br>${(person.tags||[]).map(t=>`<span class="tag">${t}</span>`).join(' ')}</div>
      `;
      const m=document.getElementById('modal');
      m.classList.add('open'); m.setAttribute('aria-hidden','false');
    }
    document.getElementById('modalClose').addEventListener('click',()=>{
      const m=document.getElementById('modal');
      m.classList.remove('open'); m.setAttribute('aria-hidden','true');
    });

    // Chat modal
    const chats={};
    function renderChat(uid){
      const list=chats[uid]||[];
      document.getElementById('msgs').innerHTML=list.map(m=>`<div class="msg ${m.from==='me'?'me':'peer'}">${m.text}</div>`).join('');
      document.getElementById('msgs').scrollTop=document.getElementById('msgs').scrollHeight
    }
    function openChat(p){
      if(!chats[p.id])chats[p.id]=[{from:'peer',text:`Hey! I'm ${p.name}. Nice to meet you üëã`}];
      document.getElementById('chatWith').textContent=`Chat with ${p.name}`;
      document.getElementById('chatModal').dataset.userId=p.id;
      renderChat(p.id);
      const cm=document.getElementById('chatModal');
      cm.classList.add('open'); cm.setAttribute('aria-hidden','false');
      updateTeamUpButton(p.id);
      setTimeout(()=>document.getElementById('msgInput').focus(),50);
    }
    document.getElementById('chatModal').addEventListener('click',e=>{
      if(e.target.id==='chatModal'){
        e.currentTarget.classList.remove('open');
        e.currentTarget.setAttribute('aria-hidden','true');
      }
    });
    document.getElementById('sendBtn').addEventListener('click',()=>{
      const uid=document.getElementById('chatModal').dataset.userId;
      const input=document.getElementById('msgInput');
      const txt=input.value.trim(); if(!txt) return;
      (chats[uid]=chats[uid]||[]).push({from:'me',text:txt});
      input.value=''; renderChat(uid);
    });
    document.getElementById('msgInput').addEventListener('keydown',e=>{ if(e.key==='Enter') document.getElementById('sendBtn').click(); });
    document.getElementById('teamUpBtn').addEventListener('click',()=>{
      const uid=document.getElementById('chatModal').dataset.userId;
      addTeammate(uid);
      alert('Team up success! üéâ');
      updateTeamUpButton(uid);
      render();
    });

    // First render
    render();
  </script>
</body>
</html>
